<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="utf-8">
    <title>Таски, таски, таски</title>
    <link rel="stylesheet" href="styles/index.css">
    <script src="components/jquery/dist/jquery.min.js"></script>
    <script src="components/angular/angular.min.js"></script>
    <script src="components/angular-route/angular-route.min.js"></script>
    <script src="components/angular-i18n/angular-locale_ru.js"></script>
    <script src="components/localforage/dist/localforage.nopromises.min.js"></script>
    <script src="scripts/index.js"></script>
  </head>
  <body>
    <div app ng-app="Caeruleus" ng-controller="ScheduleCtrl" class="b-app">
      <div ng-view></div>
      <div ng-if="isRoute('schedule')">
        <table class="b-table b-table-schedule">
          <caption class="b-table-schedule__caption">
            <div class="b-table-schedule__caption-title">
              <button ng-click="appDialogToggle('IssueFormDialog')">Add issue</button>
            </div>
            <div class="b-table-schedule__caption-nav">
              <div ng-if="schedule.mode=='week'" class="b-table-schedule__caption-nav-prev"><a ng-href="#/?view=week&amp;date={{getPrevWeekDate().toUTCString()}}">←←←</a></div>
              <div ng-if="schedule.mode=='day'" class="b-table-schedule__caption-nav-prev"><a ng-href="#/?view=day&amp;date={{getPrevDayDate().toUTCString()}}">←←</a></div>
              <div ng-if="schedule.mode=='hour'" class="b-table-schedule__caption-nav-prev"><a ng-href="#/?view=hour&amp;date={{getPrevHourDate().toUTCString()}}">←</a></div>
              <div class="b-table-schedule__caption-nav-mode"><a href="#/?view=hour" ng-class="{_active:schedule.mode=='hour'}">
                  <u>HOUR</u></a><a href="#/?view=day" ng-class="{_active:schedule.mode=='day'}">
                  <u>DAY</u></a><a href="#/?view=week" ng-class="{_active:schedule.mode=='week'}">
                  <u>WEEK</u></a></div>
              <div ng-if="schedule.mode=='hour'" class="b-table-schedule__caption-nav-next"><a ng-href="#/?view=hour&amp;date={{getNextHourDate().toUTCString()}}">→</a></div>
              <div ng-if="schedule.mode=='day'" class="b-table-schedule__caption-nav-next"><a ng-href="#/?view=day&amp;date={{getNextDayDate().toUTCString()}}">→→</a></div>
              <div ng-if="schedule.mode=='week'" class="b-table-schedule__caption-nav-next"><a ng-href="#/?view=week&amp;date={{getNextWeekDate().toUTCString()}}">→→→</a></div>
            </div>
          </caption>
          <!--thead.b-table__head.b-table-schedule__head
          tr
              th.b-table__cel.b-table-schedule__cel_title
              th.b-table__cel.b-table-schedule__cel_chunk.b-table-schedule__chunk-head(ng-repeat="chunk in schedule.chunks", ng-class="{'b-table-schedule__cel_chunk-first':$first,'b-table-schedule__cel_chunk-even':$even,'b-table-schedule__cel_chunk-odd':$odd,'b-table-schedule__cel_chunk-last':$last}" title="{{chunk.beginDate}} — {{chunk.endDate}}") h
          
          -->
          <thead class="b-table__head b-table-schedule__head b-table-schedule__head_last">
            <tr>
              <th class="b-table__cel b-table-schedule__cel_title"></th>
              <th ng-repeat="chunk in schedule.chunks" ng-class="{'b-table-schedule__cel_chunk-first':$first,'b-table-schedule__cel_chunk-even':$even,'b-table-schedule__cel_chunk-odd':$odd,'b-table-schedule__cel_chunk-last':$last}" title="{{chunk.beginDate}} — {{chunk.endDate}}" class="b-table__cel b-table-schedule__cel_chunk b-table-schedule__chunk-head">
                <div ng-if="schedule.mode=='hour'" class="b-table-schedule__chunk-head__head">
                  <label>{{chunk.beginDate | date:'HH:mm'}}</label>
                </div>
                <div ng-if="schedule.mode=='day'" class="b-table-schedule__chunk-head__head">
                  <label>{{chunk.beginDate | date:'HH.mm'}}</label><a ng-href="#/?view=hour&amp;date={{chunk.beginDate.toUTCString()}}"></a>
                </div>
                <div ng-if="schedule.mode=='week'" class="b-table-schedule__chunk-head__head">
                  <label>{{chunk.beginDate | date:'MM.dd'}}</label><a ng-href="#/?view=day&amp;date={{chunk.beginDate.toUTCString()}}"></a>
                </div>
              </th>
            </tr>
          </thead>
          <tbody ng-repeat="issue in schedule.issues track by issue.guid" ng-class="{'b-table__body_last':$last,_isStarted:issue.startedAt}" class="b-table__body">
            <tr ng-controller="ScheduleIssueCtrl as scheduleIssue">
              <td class="b-table__cel b-table-schedule__cel_title">
                <div class="b-table-schedule__issue-title"><a ng-click="selectIssue(issue); appDialogToggle('IssueViewDialog')">
                    <u>{{issue.title}}</u></a></div>
              </td>
              <td ng-repeat="issueChunk in scheduleIssue.chunks" ng-class="{'b-table__cel_first':$first,'b-table__cel_last':$last}" class="b-table__cel b-table-schedule__cel_chunk">
                <div class="b-table-schedule__cel">
                  <div ng-repeat="issueChunkInterval in issueChunk.intervals track by $index" ng-class="{_isBegin:issueChunkInterval.isBegin,_isEnd:issueChunkInterval.isEnd,_isStarted:issue.startedAt}" ng-style="{left:calcChunkIntervalLeft(issueChunk,issueChunkInterval), right:calcChunkIntervalRight(issueChunk,issueChunkInterval)}" class="b-table-schedule__cel-interval"></div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div app-dialog="IssueFormDialog" class="app-dialog">
          <div class="app-dialog__head">
            <div class="app-dialog__heading">New issue</div>
          </div>
          <div ng-form="IssueForm" ng-controller="IssueFormCtrl" class="app-dialog__body">
            <div class="row">
              <div class="col col-xs-12 col-md-6">
                <div>
                  <label>Title
                    <input name="title" ng-model="issue.title" required>
                  </label>
                </div>
                <div>
                  <label>Details
                    <textarea name="content" ng-model="issue.content"></textarea>
                  </label>
                </div>
                <button ng-click="saveIssue(issue, IssueForm)" ng-disabled="IssueForm.$invalid">Submit new issue</button>
              </div>
              <div class="col col-xs-12 col-md-6"><span>SUBTASKS (checklist)</span></div>
            </div>
          </div>
        </div>
        <div app-dialog="IssueViewDialog" class="app-dialog">
          <div class="app-dialog__head">
            <div class="app-dialog__heading">Issue</div>
          </div>
          <div ng-form="IssueForm" ng-controller="IssueFormCtrl" class="app-dialog__body">
            <div class="row">
              <div class="col col-xs-12 col-md-6">
                <h2>{{selectedIssue.title}}</h2>
                <button ng-if="!selectedIssue.startedAt" ng-click="startWork(selectedIssue)">►</button>
                <button ng-if="selectedIssue.startedAt" ng-click="stopWork(selectedIssue)">■</button>
              </div>
              <div class="col col-xs-12 col-md-6">
                <button ng-click="deleteIssue(selectedIssue)" style="float:right">DELETE</button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div ng-repeat="(key, dialog) in appDialog" class="app-overlay">
        <div ng-if="dialog.$shown" ng-click="appDialogHide(key)" class="app-overlay__bg"></div>
        <div ng-if="dialog.$shown" app-dialog-transclude="{{key}}" class="app-overlay__dialog"></div>
      </div>
    </div>
  </body>
</html>