function bTimelineService(){this.sliceIntervals=function(e,t,i){var n={beginDate:t,endDate:i};return angular.forEach(e,function(e){if(e.beginDate<n.endDate&&e.endDate>n.beginDate){var t=e.beginDate<n.beginDate?n.beginDate:e.beginDate,i=e.endDate>n.endDate?n.endDate:e.endDate,a=e.beginDate>=n.beginDate,l=e.endDate<=n.endDate;n.intervals=n.intervals||[],n.intervals.push({beginDate:t,isBegin:a,endDate:i,isEnd:l,interval:e})}}),n},this.updateDate=function(e,t){t=t||new Date,e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds())}}function bTimelineDirective(e){function t(){this.popup=null}function i(t,i,n,a){t.calcChunkIntervalLeft=function(e,t){{var i=(e.endDate.getTime()-e.beginDate.getTime())/100,n=(t.beginDate.getTime()-e.beginDate.getTime())/i;(e.endDate.getTime()-t.endDate.getTime())/i}return n+"%"},t.calcChunkIntervalRight=function(e,t){var i=(e.endDate.getTime()-e.beginDate.getTime())/100,n=(e.endDate.getTime()-t.endDate.getTime())/i;return n+"%"},t.$watchCollection("intervals",function(){if(t.intervals&&t.intervals.length){var i=e.sliceIntervals(t.intervals,t.beginDate,t.endDate);t.chunk=i}}),t.popup=null,t.popupInterval=null,t.popupShown=function(e){return t.popup===e},t.popupShow=function(e){t.popup=e,t.$emit("bTimelinePopupShow",t.popup)},t.popupShownInterval=function(e){return a.$viewValue&&a.$viewValue.interval&&a.$viewValue.interval.interval===e.interval},t.popupShowInterval=function(e){t.popupInterval=e,t.popupShow(t.bTimeline.popup),a.$viewValue&&(a.$viewValue.interval=e)},t.addInterval=function(){t.intervals.push({beginDate:new Date(t.beginDate),endDate:new Date(t.endDate)})},t.deleteInterval=function(e){var i=t.intervals.indexOf(e);~i&&t.intervals.splice(i,1)}}return t.$inject=["$scope"],{restrict:"E",require:"ngModel",template:'<div class="b-timeline"><div class="b-timeline__interval" b-timeline-interval ng-repeat="interval in chunk.intervals track by $index" ng-click="popupShowInterval(interval)" ng-class="{_isBegin:interval.isBegin,_isEnd:interval.isEnd,_isSelected:popupShownInterval(interval),_isStarted:false}" ng-style="{left:calcChunkIntervalLeft(chunk,interval), right:calcChunkIntervalRight(chunk,interval)}"></div><div class="b-timeline__popup" b-timeline-popup ng-click="popupInterval=null; popupShow(bTimelinePopup)" ng-class="{_isShown:popupShown(bTimelinePopup)}"><div class="b-timeline-popup" ng-if="popupShown(bTimelinePopup)"><div class="b-timeline-popup__main" ng-class="{_hasInterval:popupInterval}" ng-click="$event.stopPropagation()"><div class="b-timeline-popup-interval" b-timeline-popup-interval><div class="b-input-datetime" b-input-datetime ng-if="popupInterval"><div class="b-input-datetime__t"><div class="b-input-datetime__t__c b-input-datetime__t__c_input"><div class="b-input-date"><div class="b-input-date__btn b-input-date__btn_next"><button ng-click="incrBeginHours(popupInterval.interval)">+</button></div><div class="b-input-date__input"><input readonly value="{{popupInterval.interval.beginDate|date:\'HH\'}}"/></div><div class="b-input-date__btn b-input-date__btn_prev"><button ng-click="decrBeginHours(popupInterval.interval)">−</button></div></div></div><div class="b-input-datetime__t__c b-input-datetime__t__c_label">&#x3A;</div><div class="b-input-datetime__t__c b-input-datetime__t__c_input"><div class="b-input-date"><div class="b-input-date__btn b-input-date__btn_next"><button ng-click="incrBeginMinutes(popupInterval.interval)">+</button></div><div class="b-input-date__input"><input readonly value="{{popupInterval.interval.beginDate|date:\'mm\'}}"/></div><div class="b-input-date__btn b-input-date__btn_prev"><button ng-click="decrBeginMinutes(popupInterval.interval)">−</button></div></div></div><div class="b-input-datetime__t__c b-input-datetime__t__c_label">&mdash;</div><div class="b-input-datetime__t__c b-input-datetime__t__c_input"><div class="b-input-date"><div class="b-input-date__btn b-input-date__btn_next"><button ng-click="incrEndHours(popupInterval.interval)">+</button></div><div class="b-input-date__input"><input readonly value="{{popupInterval.interval.endDate|date:\'HH\'}}"/></div><div class="b-input-date__btn b-input-date__btn_prev"><button ng-click="decrEndHours(popupInterval.interval)">−</button></div></div></div><div class="b-input-datetime__t__c b-input-datetime__t__c_label">&#x3A;</div><div class="b-input-datetime__t__c b-input-datetime__t__c_input"><div class="b-input-date"><div class="b-input-date__btn b-input-date__btn_next"><button ng-click="incrEndMinutes(popupInterval.interval)">+</button></div><div class="b-input-date__input"><input readonly value="{{popupInterval.interval.endDate|date:\'mm\'}}"/></div><div class="b-input-date__btn b-input-date__btn_prev"><button ng-click="decrEndMinutes(popupInterval.interval)">−</button></div></div></div></div></div><div class="b-timeline-popup-interval__btn b-timeline-popup-interval__btn_create" ng-if="!popupInterval"><button ng-click="addInterval()">Add interval</button></div><div class="b-timeline-popup-interval__btn b-timeline-popup-interval__btn_create" ng-if="popupInterval"><button ng-click="deleteInterval(popupInterval.interval)">Delete interval</button></div></div></div></div></div></div>',scope:{beginDate:"=timelineBeginDate",endDate:"=timelineEndDate",intervals:"=timelineIntervals"},controllerAs:"bTimeline",controller:t,link:i}}function bTimelineIntervalDirective(){function e(){}return{restrict:"A",require:"^bTimeline",link:e}}function bTimelinePopupDirective(){function e(){}function t(e){e.$on("bTimelinePopupShown",function(t,i){e.bTimelinePopup!==i&&(e.popup=null)}),e.bTimeline.popup=e.bTimelinePopup}return e.$inject=["$scope"],{restrict:"A",require:"^bTimeline",controllerAs:"bTimelinePopup",controller:e,link:t}}function bTimelinePopupIntervalDirective(){function e(e){e.$on("$destroy",function(){console.warn("destroy popup interval",e.popupInterval),e.popupInterval})}return{restrict:"A",require:"^bTimelinePopup",link:e}}function bInputDatetimeDirective(){function e(e){e.incrBeginHours=function(e){e.beginDate.setHours(e.beginDate.getHours()+1),e.beginDate>e.endDate&&e.beginDate.setTime(e.endDate.getTime())},e.incrBeginMinutes=function(e){e.beginDate.setMinutes(e.beginDate.getMinutes()+5),e.beginDate>e.endDate&&e.beginDate.setTime(e.endDate.getTime())},e.decrBeginHours=function(e){e.beginDate.setHours(e.beginDate.getHours()-1)},e.decrBeginMinutes=function(e){e.beginDate.setMinutes(e.beginDate.getMinutes()-5)},e.incrEndHours=function(e){e.endDate.setHours(e.endDate.getHours()+1)},e.incrEndMinutes=function(e){e.endDate.setMinutes(e.endDate.getMinutes()+5)},e.decrEndHours=function(e){e.endDate.setHours(e.endDate.getHours()-1),e.endDate<e.beginDate&&e.endDate.setTime(e.beginDate.getTime())},e.decrEndMinutes=function(e){e.endDate.setMinutes(e.endDate.getMinutes()-5),e.endDate<e.beginDate&&e.endDate.setTime(e.beginDate.getTime())}}return{restrict:"A",link:e}}angular.module("bTimeline",[]).service("bTimeline",bTimelineService).directive("bTimeline",bTimelineDirective).directive("bTimelineInterval",bTimelineIntervalDirective).directive("bTimelinePopup",bTimelinePopupDirective).directive("bTimelinePopupInterval",bTimelinePopupIntervalDirective).directive("bInputDatetime",bInputDatetimeDirective),bTimelineDirective.$inject=["bTimeline"],bTimelineIntervalDirective.$inject=["bTimeline"],bTimelinePopupDirective.$inject=["bTimeline"],bTimelinePopupIntervalDirective.$inject=["bTimeline"],bInputDatetimeDirective.$inject=["bTimeline"];